#!/usr/bin/env ruby
class Resource
  def initialize(path)
    @path = path
  end

  def to_s
    File.expand_path(File.join(File.dirname(__FILE__), '..', 'resources', 'jsettlers-1.0.6', @path))
  end
end

system "java -jar #{Resource.new('JSettlersServer.jar')} 8880 10 root '' &"
server_pid = $?.pid
puts "Server PID: #{server_pid}"
sleep 5

robot_pids = {}
3.times do |robot_number|
  system "java -cp #{Resource.new('JSettlersServer.jar')} soc.robot.SOCRobotClient localhost 8880 Robot#{robot_number} '' &"
  robot_pids[robot_number] = $?.pid
  puts "Robot#{robot_number} PID: #{robot_pids[robot_number]}"
end

system "java -jar #{Resource.new('JSettlers.jar')} localhost 8880"

robot_pids.each do |robot_number, pid|
  puts "Cleaning up: killing Robot#{robot_number}"
  system "kill #{pid}"
end

puts "Cleaning up: killing Server"
system "kill #{server_pid}"

exit 0